block content
    include ../components/forum/forumTopics.jade
block javascript
    script(type="text/javascript").
        $(function () {
            $.getJSON = function (url, token, callback) {
                return jQuery.ajax({
                    'headers': {
                        'Content-Type': 'application/json',
                        'token': token
                    },
                    'type': 'GET',
                    'url': url,
                    'dataType': 'json',
                    'success': callback,
                    'error': function (jqXHR, textStatus, errorThrown) {
                        alert('Error: ' + errorThrown);
                    }
                });
            };

            $.getJSON("http://localhost:8080/topics", sessionStorage.accessToken, function (data, status) {
                var inside = '<tr class="titleTr"><td class="titleTd">Topics</td><td class="plusTd"></td></tr>';
                inside += '<tr class="headingTr"><td colspan="2">Title</td></tr>';
                $('table.flatTable').append(inside);
                var i;
                for (i = 0; i < data.length; i++) {
                    inside = "";
                    inside += '<tr><td colspan="2"><a onclick="openTopic(\'' + data[i].title + '\')">' + data[i].title + '</a></td></tr>';
                    $('table.flatTable').append(inside);
                }
            });

            this.openTopic = function (topicTitle) {
                var url = "http://localhost:8080/threads/topic/" + encodeURIComponent(topicTitle);

                var table = document.getElementsByClassName("flatTable")[0];
                table.innerHTML = '';

                var inside = '<tr class="titleTr"><td class="titleTd">Threads</td><td class="plusTd"></td></tr>';
                inside += '<tr class="headingTr"><td>Title</td><td>Owner</td></tr>';
                $('table.flatTable').append(inside);

                $.getJSON(url, sessionStorage.accessToken, function (data, status) {
                    var i;
                    for (i = 0; i < data.length; i++) {
                        inside = "";
                        inside += '<tr><td><a onclick="openThread(\'' + data[i].topic + '\', \'' + data[i].title + '\')">'
                                + data[i].title + '</a></td><td>' + data[i].owner + '</td></tr>';
                        $('table.flatTable').append(inside);
                    }
                });
            };

            this.openThread = function (topicTitle, threadTitle) {
                var url = "http://localhost:8080/comments/thread?topicTitle=" + encodeURIComponent(topicTitle);
                url += "&threadTitle=" + encodeURIComponent(threadTitle);

                var table = document.getElementsByClassName("flatTable")[0];
                table.innerHTML = '';

                var inside = '<tr class="titleTr"><td colspan="2" class="titleTd">Comments</td><td class="plusTd"></td></tr>';
                inside += '<tr class="headingTr"><td>Owner</td><td>Message</td><td>Timestamp</td></tr>';
                $('table.flatTable').append(inside);

                $.getJSON(url, sessionStorage.accessToken, function (data, status) {
                    var i;
                    for (i = 0; i < data.length; i++) {
                        inside = "";

                        data[i].timestamp = moment(data[i].timestamp).format('YYYY-MM-DD HH:mm');

                        inside += '<tr><td>' + data[i].owner + '</td><td>' + data[i].message + '</td><td>'
                                + data[i].timestamp + '</td></tr>';
                        $('table.flatTable').append(inside);
                    }
                });
            };
        });